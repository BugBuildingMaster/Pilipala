
@{
    Layout = "~/Views/Shared/_MyLayout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="Luba">
    <meta name="keywords" content="HTML,CSS,JavaScript">
    <meta name="author" content="HiBootstrap">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="referrer" content="no-referrer">
    <link href="~/assets/css/style.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/vue.js"></script>
    <script src="~/Scripts/axios.js"></script>
    <script src="~/Scripts/axioshttp.js"></script>
    <title>OriginSearch</title>
    <style>
        .mainForm {
            margin: auto;
            width: 42rem;
            height: 30rem;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 13rem;
        }

        input {
            outline: none;
        }

        .search_input {
            width: 35.5rem;
            height: 2.5rem;
            border-radius: 10px;
            border: grey 2px solid;
        }

        .inp_sub {
            background-color: rgb(0, 148, 255);
            color: rgb(255, 255, 255);
            border: hidden;
            padding: 7px 10px 7px 10px;
            border-radius: 10%;
            background-color: #0094ff;
            color: #fff;
            border: hidden;
            width: 4.8rem;
            height: 2.8rem;
            font-size: 1rem;
        }

        .theLogo {
            width: 20rem;
            margin: 0 auto;
        }

        .LoGo {
            width: 100%;
        }

        .suggest {
            width: 35.5rem;
            margin-top: -0.24rem;
            border-bottom-color: #d6d6d6;
            cursor: default;
        }

        .sugChi {
            background-color: #efefef;
            border: 1px solid #00000005;
        }

        .sugPar {
            border: 2px solid #0094ff !important;
            border-top: 2px solid #ffffff00 !important;
        }
    </style>
</head>
<body>
    <script>
        document.onreadystatechange = function () {
            loading();
        }

        function loading() {
            var list = ['../public/static/uploads/openinggif/smalllogo1.gif', '../public/static/uploads/openinggif/smalllogo2.gif'];
            document.getElementById('logoimg').addEventListener('mouseover', function () {
                var ranLogo = list[Math.round(Math.random())];
                document.getElementById('logoimg').src = ranLogo;
            });
        }
    </script>
    <div class="mainForm">
        <div class="theLogo">
            <a href="..">
                <img class="LoGo" id="logoimg" src="~/public/static/uploads/openinggif/smalllogo1.gif" alt="pilipala网" />
            </a>
        </div>
        <form id="form1" name="form1" method="post" action="" target="iframe" @*target="_blank"*@ onsubmit="addSearch()">
            <div id="theSearch">
                <input class="search_input" type="text" placeholder="" name="keyword" autocomplete="off" id="input_text" v-on:input="setSug()" v-on:porpertychange="setSug()" v-on:focus="changeSug()" onmouseover="changecolor(1)" onmouseout="changecolor(0)">
                <input type="hidden" name="sid" value="">
                <input class="inp_sub" type="submit" value="搜索" id="sub">
                <div id="suggestion" class="suggest" style="display:none;position: absolute;z-index: 100;">
                    <ul class="list-group sugPar">
                        <li class="list-group-item sugChi" v-for="(single,i) in suggestions" v-on:mouseover="light($event)" v-on:mouseout="dark($event)" onclick="addSearch();">{{single}}</li>
                    </ul>
                </div>
            </div>
        </form>
        <iframe id="iframe" name="iframe" style="display:none;"></iframe>
    </div>
    <script>
        $("body").click(function (e) {
            if ($.contains($("#input_text")[0], e.target) || $("#input_text")[0] == e.target || $.contains($("#suggestion")[0], e.target) || $("#suggestion")[0] == e.target) {
            } else {
                var input = document.getElementById("input_text");
                var suggestion = document.getElementById("suggestion");
                suggestion.style.display = "none";
                input.style.borderBottomColor = "grey";
                input.style.borderRadius = "10px";
                changecolor(0);
            }
        });

        function changecolor(num) {
            var input = document.getElementById("input_text");
            var suggestion = document.getElementById("suggestion");
            if (num == 1)
                if (suggestion.style.display == "block")
                    return null;
                else
                    input.style.border = "#0094ff 2px solid";
            else
                if (document.activeElement.id == "input_text")
                    return null;
                else
                    input.style.border = "grey 2px solid";
        }

        var sug = null;
        const searching = new Vue({
            el: "#theSearch",
            data: {
                suggestions: []
            },
            created() {
                this.changeSug(0);
                document.title = "想知道什么搜搜看吧 (ゝ∀･)";
                var input = document.getElementById("input_text");
                input.style.borderBottomColor = "grey";
            },
            mouted() {

            },
            methods: {
                //搜索提示
                async suggest() {
                    const { data: res } = await axios.get('/Search/getSuggest', {
                        params: {
                            keyWord: $('#input_text').val()
                        }
                    })
                    this.suggestions = res["suggestion"];
                    //console.log(this.suggestions);
                    this.changeSug(1)
                },
                //提示防抖
                async setSug() {
                    clearTimeout(sug);
                    sug = setTimeout(this.suggest, 150);
                },
                //提示框样式改变
                async changeSug() {
                    var input = document.getElementById("input_text");
                    var suggestion = document.getElementById("suggestion");
                    if (this.suggestions.length != 0) {
                        suggestion.style.display = "block";
                        input.style.borderBottomColor = "#d6d6d6";
                        input.style.borderRadius = "10px 10px 0px 0px";
                    }
                    else {
                        suggestion.style.display = "none";
                        input.style.borderBottomColor = "#0094ff";
                        input.style.borderRadius = "10px";
                    }
                },
                //鼠标悬浮选项样式改变
                async light(event) {
                    $(event.target).addClass('active');
                    $('#input_text').val(event.target.innerText);
                },
                async dark(event) {
                    $(event.target).removeClass('active');
                }
            }
        })
    </script>
    <script>
        function addSearch() {
            if ($('#input_text').val() == "") {
                window.location.href = "/Search/OriginSearch";
            }
            else {
                const url = "/Search/Search?KeyWord=" + $('#input_text').val();
                window.location.href = url;
            }
        }
    </script>
</body>
</html>
